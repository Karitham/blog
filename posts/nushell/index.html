<!DOCTYPE html>
<html lang="en">
  <head id="head">
    <meta charset="UTF-8">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@KarithamIRL">
    <meta name="twitter:author" content="@KarithamIRL">
    <meta name="twitter:description" content="Shells have been held back far too long by sh compatibility, and the ecosystem suffered.">
    <meta name="twitter:title" content="Nushell is great">
    <meta name="twitter:image" content="https://avatars.githubusercontent.com/u/57440386">
    <meta property="og:title" content="Nushell is great">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://avatars.githubusercontent.com/u/57440386">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Shells have been held back far too long by sh compatibility, and the ecosystem suffered.">
    <link rel="icon" href="https://avatars.githubusercontent.com/u/57440386" type="image/x-icon">
    <title id="title">
      Nushell is great- Kar
    </title>
    <link rel="stylesheet" type="text/css" href="/normalize.css">
    <link rel="stylesheet" type="text/css" href="/ctp.css">
    <link rel="stylesheet" type="text/css" href="/style.css">
    

  </head>
  <body>
    <div id="content">
      
  <nav id="nav">
    <ul>
      <li><a href="/" role="button" class="button">~/</a></li>
    </ul>
  </nav>
  <div id="main">
    
  <main>
    <div class="post">
      <h1>Nushell is great</h1>
      <div class="head-footer">
        <div>By
          <span class="emph">Karitham</span></div>
        <div
        >Posted on:
          <span class="emph">September 21, 2024</span></div>
        <div class="tags">
          
            Tags:
            
              <span class="emph">nushell</span><span>,</span>
            
              <span class="emph">scripting</span><span></span>
            
          
        </div>
      </div>
      <div><p>I dislike configuring my software. I like when the defaults are sane and powerful. I like when I can just pop in once in a while in the configuration settings. Add something (not remove it), and it just works.</p><p>Fish is like that. I used it for the longest time. Then I got swept up by the mass of zsh users with their fancy looking prompts, and their <em>standards</em>. So, for the past 2 years I've used zsh. It didn't really make much of a difference to me, except the scripting part was just a little bit worse. Less ergonomic.</p><p>Since then, I've learned a lot and switched roles, ending up in a SRE/Ops sort of situation where I write a ton more scripts, or write big one-liners. Unfortunately, I'm bad at that.</p><p>What I'm good at, is high level, typed, functional languages. So when I discovered <a href="https://www.nushell.sh/" target="_blank">nushell</a>, I was sold.</p><p>The model is quite intuitive and more representative of modern programming languages. Types are either primitives (<code>int</code>,<code>string</code>,<code>bool</code>), records (sometimes called tables) or lists. Yes, there's bools.</p><p>Nu allows you to represent most data formats natively, and it has built-in support for a huge number of them, with a plugin system to allow even more. It can ingest csv and turn it into yaml, no dirty sed + awk'ing.</p><h3>Example</h3><pre><code>#!/usr/bin/env nu
let ns_names: list&lt;string&gt; = [
    &quot;standalone&quot;,
    (&quot;service1-{test,stag,prod}&quot; | str expand),
    (&quot;service2-{test,stag,prod}&quot; | str expand),
    (&quot;team3-{test,stag,prod}&quot; | str expand),
] | flatten | sort

let namespaces = $ns_names | each {{
    apiVersion: &quot;v1&quot;,
    kind: &quot;Namespace&quot;,
    metadata: { name: $in },
}}

{
    apiVersion: &quot;v1&quot;,
    kind: &quot;List&quot;,
    items: $namespaces
} | to yaml | save -f $&quot;($env.PROCESS_PATH | path dirname)/namespaces.yaml&quot;
</code></pre><p>gives</p><pre><code class="yaml"><span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">List</span>
<span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
<span class="property">items</span><span class="punctuation delimiter">:</span>
<span class="punctuation delimiter">-</span> <span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
  <span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">Namespace</span>
  <span class="property">metadata</span><span class="punctuation delimiter">:</span>
    <span class="property">name</span><span class="punctuation delimiter">:</span> <span class="string">service1-prod</span>
<span class="punctuation delimiter">-</span> <span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
  <span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">Namespace</span>
  <span class="property">metadata</span><span class="punctuation delimiter">:</span>
    <span class="property">name</span><span class="punctuation delimiter">:</span> <span class="string">service1-stag</span>
<span class="punctuation delimiter">-</span> <span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
  <span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">Namespace</span>
  <span class="property">metadata</span><span class="punctuation delimiter">:</span>
    <span class="property">name</span><span class="punctuation delimiter">:</span> <span class="string">service1-test</span>
<span class="punctuation delimiter">-</span> <span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
  <span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">Namespace</span>
  <span class="property">metadata</span><span class="punctuation delimiter">:</span>
    <span class="property">name</span><span class="punctuation delimiter">:</span> <span class="string">service2-prod</span>
<span class="punctuation delimiter">-</span> <span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
  <span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">Namespace</span>
  <span class="property">metadata</span><span class="punctuation delimiter">:</span>
    <span class="property">name</span><span class="punctuation delimiter">:</span> <span class="string">service2-stag</span>
<span class="punctuation special">...</span>
</code></pre>
<p>I'm sparing you the rest, along with all the typos.</p><p>It's so much better than writing it by hand!</p><h3>Using it day to day</h3><p>You might be wondering why we're outputting yaml here, instead of directly applying it.</p><p>It would be a great option when working on a solo project, but on a project you don't own, I rather give an escape hatch.</p><p>New, shiny tools have a low adoption, and you can't expect everyone to have them installed on their system (yes, they could just use <a href="https://nixos.org" target="_blank"><code>nix</code></a>).</p><p>Saving the results as a file that gets commited to git makes collaboration that much easier. If others just want to append to the list manually they can do so. I can keep using my script as long as I keep it up to date. Unfortunately, that's the cost to pay for using non-standard tools.</p><p>On solo projects, the script above would be simpler, and could even be abstracted to build an entire k8s cluster the GitOps way, only through nushell!</p></div>
    </div>
  </main>

  </div>

    </div>
  </body>
  <footer id="footer">
    
  </footer>
</html>